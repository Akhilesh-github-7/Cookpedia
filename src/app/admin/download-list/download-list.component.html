<mat-sidenav-container class="admin-container">
  <mat-sidenav mode="side" [opened]="true" class="admin-sidenav shadow">
    <app-sidebar></app-sidebar>
  </mat-sidenav>

  <mat-sidenav-content>
    <mat-toolbar class="top-toolbar border-bottom bg-white">
      <span class="ms-2 fw-bold">Download Analytics</span>
    </mat-toolbar>

    <div class="page-content p-4">
      <mat-card class="shadow-sm border-0">
        <mat-card-header class="mb-3 d-flex justify-content-between align-items-center">
          <mat-card-title class="fw-bold">All Downloaded Recipes</mat-card-title>
          <mat-form-field appearance="outline" class="search-field">
            <mat-label>Search downloads...</mat-label>
            <input matInput [(ngModel)]="searchKey" placeholder="Ex. Pasta">
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>
        </mat-card-header>

        <mat-card-content>
          <div class="table-responsive">
            <table class="table table-hover align-middle">
              <thead>
                <tr class="table-light">
                  <th class="ps-3">#</th>
                  <th>Recipe Name</th>
                  <th>Cuisine</th>
                  <th class="text-center">Download Count</th>
                </tr>
              </thead>
              <tbody>
                @for (item of allDownloads | search:searchKey | paginate: { itemsPerPage: 10, currentPage: p }; track $index; let i = $index) {
                  <tr>
                    <td class="ps-3 fw-bold">{{ (p - 1) * 10 + i + 1 }}</td>
                    <td class="fw-medium">{{item.recipeName}}</td>
                    <td><span class="badge bg-info bg-opacity-10 text-info border border-info border-opacity-25 px-3 py-2">{{item.recipeCuisine}}</span></td>
                    <td class="text-center fw-bold text-success">{{item.count}}</td>
                  </tr>
                }
                @if ((allDownloads | search:searchKey).length === 0) {
                  <tr>
                    <td colspan="4" class="text-center py-5">
                      <mat-icon class="display-4 text-muted mb-3">cloud_off</mat-icon>
                      <h3 class="text-muted">No Downloads Found</h3>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
          
          <div class="pagination-container d-flex justify-content-center mt-4">
            <pagination-controls (pageChange)="p = $event"></pagination-controls>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
