<mat-sidenav-container class="admin-container">
  <mat-sidenav mode="side" [opened]="true" class="admin-sidenav shadow">
    <app-sidebar></app-sidebar>
  </mat-sidenav>

  <mat-sidenav-content>
    <mat-toolbar class="top-toolbar border-bottom bg-white">
      <span class="ms-2 fw-bold">User Testimonies</span>
    </mat-toolbar>

    <div class="page-content p-4">
      <mat-card class="shadow-sm border-0">
        <mat-card-header class="mb-3">
          <mat-card-title class="fw-bold">Feedback Requests</mat-card-title>
        </mat-card-header>

        <mat-card-content>
          <div class="table-responsive">
            <table class="table table-hover align-middle">
              <thead>
                <tr class="table-light">
                  <th class="ps-3">#</th>
                  <th>User</th>
                  <th>Email</th>
                  <th>Feedback</th>
                  <th class="text-center">Status</th>
                  <th class="text-center">Actions</th>
                </tr>
              </thead>
              <tbody>
                @for (item of allfeedbacks | paginate: { itemsPerPage: 10, currentPage: p }; track $index; let i = $index) {
                  <tr>
                    <td class="ps-3 fw-bold">{{ (p - 1) * 10 + i + 1 }}</td>
                    <td class="fw-medium">{{item.name}}</td>
                    <td>{{item.email}}</td>
                    <td class="text-muted text-wrap" style="max-width: 300px;">"{{item.message}}"</td>
                    <td class="text-center">
                      <span class="badge px-3 py-2 border" 
                        [ngClass]="{
                          'bg-warning-subtle text-warning-emphasis border-warning-subtle': item.status === 'Pending',
                          'bg-success-subtle text-success-emphasis border-success-subtle': item.status === 'Approved',
                          'bg-danger-subtle text-danger-emphasis border-danger-subtle': item.status === 'Rejected'
                        }">
                        {{item.status}}
                      </span>
                    </td>
                    <td class="text-center">
                      @if (item.status === 'Pending') {
                        <div class="d-flex justify-content-center gap-2">
                          <button mat-mini-fab color="primary" (click)="updateFeedbackStatus(item._id, 'Approved')" matTooltip="Approve">
                            <mat-icon>check</mat-icon>
                          </button>
                          <button mat-mini-fab color="warn" (click)="updateFeedbackStatus(item._id, 'Rejected')" matTooltip="Reject">
                            <mat-icon>close</mat-icon>
                          </button>
                        </div>
                      } @else {
                        <mat-icon class="text-muted">lock</mat-icon>
                      }
                    </td>
                  </tr>
                }
                @if (allfeedbacks.length === 0) {
                  <tr>
                    <td colspan="6" class="text-center py-5">
                      <mat-icon class="display-4 text-muted mb-3">chat_bubble_outline</mat-icon>
                      <h3 class="text-muted">No Requests Found</h3>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
          
          <div class="pagination-container d-flex justify-content-center mt-4">
            <pagination-controls (pageChange)="p = $event"></pagination-controls>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
