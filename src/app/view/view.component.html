<div class="recipe-view-container container py-5">
  @if (recipe.name) {
    <!-- Back Header -->
    <div class="mb-4">
      <button mat-button color="primary" routerLink="/all-recipes">
        <mat-icon>arrow_back</mat-icon> Back to Recipes
      </button>
    </div>

    <div class="row g-5">
      <!-- Left Column: Image & Actions -->
      <div class="col-lg-5">
        <mat-card class="recipe-image-card shadow-sm">
          <img mat-card-image [src]="recipe.image" [alt]="recipe.name" class="main-recipe-img">
        </mat-card>
        
        <div class="action-buttons mt-4 d-flex gap-3">
          <button mat-raised-button color="primary" class="flex-grow-1 action-btn py-2" (click)="downloadRecipe()">
            <mat-icon>download</mat-icon> Download PDF
          </button>
          <button mat-stroked-button color="accent" class="flex-grow-1 action-btn py-2" (click)="saveRecipe()">
            <mat-icon>favorite_border</mat-icon> Save to Collection
          </button>
        </div>

        <!-- Quick Info Chips -->
        <div class="quick-info mt-4">
          <mat-chip-set>
            <mat-chip highlighted color="primary">
              <mat-icon matChipAvatar>restaurant</mat-icon>
              {{recipe.cuisine}}
            </mat-chip>
            <mat-chip>
              <mat-icon matChipAvatar>group</mat-icon>
              Serves {{recipe.servings}}
            </mat-chip>
            <mat-chip>
              <mat-icon matChipAvatar>equalizer</mat-icon>
              {{recipe.difficulty}}
            </mat-chip>
          </mat-chip-set>
        </div>
      </div>

      <!-- Right Column: Details -->
      <div class="col-lg-7">
        <h1 class="recipe-title mb-4">{{ recipe.name }}</h1>
        
        <!-- Stats Row -->
        <div class="stats-container p-4 rounded-4 bg-white shadow-sm mb-5 d-flex justify-content-around text-center">
          <div class="stat-item">
            <div class="stat-icon-bg prep">
              <mat-icon>timer</mat-icon>
            </div>
            <p class="stat-label mb-0">Prep Time</p>
            <h5 class="stat-value">{{recipe.prepTimeMinutes}} min</h5>
          </div>
          <mat-divider vertical></mat-divider>
          <div class="stat-item">
            <div class="stat-icon-bg cook">
              <mat-icon>outdoor_grill</mat-icon>
            </div>
            <p class="stat-label mb-0">Cook Time</p>
            <h5 class="stat-value">{{recipe.cookTimeMinutes}} min</h5>
          </div>
          <mat-divider vertical></mat-divider>
          <div class="stat-item">
            <div class="stat-icon-bg calories">
              <mat-icon>local_fire_department</mat-icon>
            </div>
            <p class="stat-label mb-0">Calories</p>
            <h5 class="stat-value">{{recipe.caloriesPerServing}} kcal</h5>
          </div>
        </div>

        <!-- Ingredients -->
        <div class="details-section mb-5">
          <h2 class="section-title">
            <mat-icon class="me-2">shopping_basket</mat-icon> Ingredients Needed
          </h2>
          <mat-list class="ingredients-list">
            @for(item of recipe.ingredients; track $index) {
              <mat-list-item>
                <mat-icon matListItemIcon class="text-success">check_circle_outline</mat-icon>
                <span matListItemTitle>{{ item }}</span>
              </mat-list-item>
              <mat-divider></mat-divider>
            }
          </mat-list>
        </div>

        <!-- Instructions -->
        <div class="details-section">
          <h2 class="section-title">
            <mat-icon class="me-2">menu_book</mat-icon> Cooking Instructions
          </h2>
          <div class="instructions-stepper">
            @for(step of recipe.instructions; track $index) {
              <div class="instruction-step d-flex gap-3 mb-4">
                <div class="step-number">{{$index + 1}}</div>
                <div class="step-content">
                  <p class="mb-0">{{ step }}</p>
                </div>
              </div>
            }
          </div>
        </div>
      </div>
    </div>

    <!-- Related Recipes -->
    <div class="related-section mt-5 pt-5">
      <h2 class="section-title mb-4">Related Recipes</h2>
      <div class="row g-4">
        @if (allRelatedRecipes.length > 0) {
          @for (item of allRelatedRecipes; track $index) {
            <div class="col-lg-2 col-md-4 col-sm-6">
              <mat-card class="related-recipe-card h-100 shadow-sm" [routerLink]="['/recipe', item._id, 'view']">
                <img mat-card-image [src]="item.image" [alt]="item.name" class="related-img">
                <mat-card-content class="p-2">
                  <h6 class="related-title text-truncate" [title]="item.name">{{ item.name }}</h6>
                </mat-card-content>
              </mat-card>
            </div>
          }
        } @else {
          <div class="col-12">
            <p class="text-muted italic">No related recipes found for this cuisine.</p>
          </div>
        }
      </div>
    </div>
  } @else {
    <div class="text-center py-5">
      <mat-spinner diameter="50" class="mx-auto mb-3"></mat-spinner>
      <p>Loading recipe details...</p>
    </div>
  }
</div>
